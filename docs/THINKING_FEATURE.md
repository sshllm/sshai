# 深度思考功能说明

## 功能概述

SSH AI 服务器现在支持显示支持深度思考的AI模型（如DeepSeek-V3）的思考过程，让用户能够看到AI在回答问题时的推理步骤。

## 功能特性

### 1. 思考内容显示
- 当AI模型进行深度思考时，会实时显示思考过程
- 思考内容会自动换行，支持中文显示
- 思考过程和最终回答会明确分隔

### 2. 状态指示
- **思考阶段**: 显示 "--- 思考中 ---" 标题和旋转动画 "⠋ 思考中..."
- **回答阶段**: 显示 "--- 开始回答 ---" 标题，然后输出最终回答
- **普通模型**: 直接显示回答内容，无思考过程

### 3. 交互控制
- 在思考或回答过程中可以按 Ctrl+C 中断
- 支持实时显示，无需等待完整响应

## 技术实现

### API响应结构
```json
{
  "choices": [{
    "delta": {
      "reasoning": "思考内容...",         // DeepSeek-V3等模型
      "reasoning_content": "思考内容...", // DeepSeek-R1模型
      "content": "回答内容..."
    }
  }]
}
```

### 处理流程
1. **检测思考内容**: 监听API响应中的 `reasoning` 字段
2. **显示思考过程**: 实时输出思考内容，显示思考动画
3. **切换到回答**: 收到 `content` 字段时切换到回答模式
4. **内容格式化**: 自动换行，支持UTF-8字符

## 使用示例

### 连接服务器
```bash
# 连接到支持深度思考的模型
ssh deepseek-v3@localhost -p 2212

# 或选择其他模型
ssh gpt@localhost -p 2212
```

### 测试深度思考
输入需要复杂推理的问题：
```
请详细分析量子计算的工作原理，并解释它与传统计算的区别
```

### 预期输出
```
--- 思考中 ---
⠋ 思考中...

量子计算是基于量子力学原理的计算方式...
[思考过程实时显示]

--- 开始回答 ---
量子计算是一种利用量子力学现象进行信息处理的计算方式...
[最终回答内容]
```

## 支持的模型

### 深度思考模型
- **DeepSeek-V3**: 完整支持思考过程显示 (使用 `reasoning` 字段)
- **DeepSeek-R1**: 完整支持思考过程显示 (使用 `reasoning_content` 字段)
- **其他支持思考的模型**: 根据API响应自动检测

### 普通模型
- **GPT系列**: 直接显示回答，无思考过程
- **其他模型**: 按标准流式响应处理

## 测试方法

### 自动测试
```bash
# 通用思考功能测试
./test_thinking.sh

# DeepSeek-R1 专项测试
./test_r1_final.sh
```

### 手动测试
1. 启动服务器: `./sshai`
2. 连接到支持思考的模型:
   - DeepSeek-V3: `ssh deepseek-v3@localhost -p 2212`
   - DeepSeek-R1: `ssh deepseek-r1@localhost -p 2212`
   - 或简写: `ssh r1@localhost -p 2212`
3. 输入复杂问题观察思考过程
4. 测试中断功能: 在思考或回答时按 Ctrl+C

## 配置说明

### API配置
- **API Base**: https://ds.openugc.com/v1
- **API Key**: 
- **支持模型**: 自动从 `/v1/models` 获取

### 显示配置
- **终端宽度**: 80字符自动换行
- **动画频率**: 100ms更新间隔
- **字符编码**: UTF-8支持中文

## 故障排除

### 常见问题

1. **思考内容不显示**
   - 检查模型是否支持 `reasoning` 字段
   - 确认API响应格式正确

2. **中文显示异常**
   - 确保终端支持UTF-8编码
   - 检查字体是否支持中文字符

3. **动画不流畅**
   - 检查网络连接稳定性
   - 确认终端性能足够

### 调试方法
- 查看API响应: 在代码中添加日志输出
- 测试网络连接: `curl -X POST https://ds.openugc.com/v1/chat/completions`
- 验证模型支持: 检查 `/v1/models` 返回的模型列表

## 更新日志

### v1.3.1 (当前版本)
- ✅ 修复DeepSeek-R1模型思考内容显示问题
- ✅ 添加对 `reasoning_content` 字段的支持
- ✅ 同时支持多种思考字段格式 (`reasoning` 和 `reasoning_content`)
- ✅ 优化字段检测逻辑，提高兼容性

### v1.3.0
- ✅ 新增深度思考内容显示
- ✅ 添加思考状态动画
- ✅ 支持思考过程中断
- ✅ 优化中文字符处理
- ✅ 改进响应流处理逻辑

### 计划功能
- 🔄 思考内容语法高亮
- 🔄 思考过程保存到历史
- 🔄 自定义思考显示格式
- 🔄 思考时间统计