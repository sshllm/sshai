# SSH AI æœåŠ¡å™¨ BUG ä¿®å¤æ–‡æ¡£

## ä¿®å¤æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤è§£å†³äº†æ¨¡å—åŒ–é‡æ„åå‘ç°çš„5ä¸ªå…³é”®BUGï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒçš„å®Œæ•´æ€§å’ŒåŠŸèƒ½çš„æ­£ç¡®æ€§ã€‚

## ä¿®å¤çš„é—®é¢˜åˆ—è¡¨

### 1. é‡å¤çš„"å·²é€‰æ‹©æ¨¡å‹"æç¤º âœ…

**é—®é¢˜æè¿°**: ç”¨æˆ·åœ¨é€‰æ‹©æ¨¡å‹åï¼Œç³»ç»Ÿæ˜¾ç¤ºäº†ä¸¤æ¬¡"å·²é€‰æ‹©æ¨¡å‹"çš„æç¤ºä¿¡æ¯ã€‚

**é—®é¢˜åŸå› **: 
- `pkg/ssh/session.go` ç¬¬53è¡Œæœ‰ä¸€æ¬¡è¾“å‡º
- `pkg/ai/models.go` ç¬¬140è¡Œåˆæœ‰ä¸€æ¬¡è¾“å‡º

**ä¿®å¤æ–¹æ¡ˆ**: 
ç§»é™¤ `pkg/ssh/session.go` ä¸­çš„é‡å¤è¾“å‡ºï¼Œåªä¿ç•™ `pkg/ai/models.go` ä¸­çš„è¾“å‡ºã€‚

**ä¿®å¤ä»£ç **:
```go
// ä¿®å¤å‰
selectedModel := ai.SelectModelByUsername(channel, models, username)
channel.Write([]byte(fmt.Sprintf("å·²é€‰æ‹©æ¨¡å‹: %s\r\n", selectedModel)))

// ä¿®å¤å
selectedModel := ai.SelectModelByUsername(channel, models, username)
```

### 2. å¤§æ¨¡å‹å›ç­”å†…å®¹æ¢è¡Œé—®é¢˜ âœ…

**é—®é¢˜æè¿°**: å¤§æ¨¡å‹çš„å›ç­”å†…å®¹æ²¡æœ‰æ­£ç¡®æ¢è¡Œï¼Œå¯¼è‡´æ˜¾ç¤ºæ··ä¹±ã€‚

**é—®é¢˜åŸå› **: 
- æµå¼å“åº”å¤„ç†ä¸­æ²¡æœ‰æ­£ç¡®å¤„ç†æ¢è¡Œç¬¦
- `WrapText` å‡½æ•°è°ƒç”¨åæ²¡æœ‰æŒ‰è¡Œå¤„ç†å†…å®¹

**ä¿®å¤æ–¹æ¡ˆ**: 
æ”¹è¿›å†…å®¹æ˜¾ç¤ºé€»è¾‘ï¼ŒæŒ‰è¡Œå¤„ç†å†…å®¹å¹¶ç¡®ä¿æ­£ç¡®æ¢è¡Œã€‚

**ä¿®å¤ä»£ç **:
```go
// ä¿®å¤åçš„å†…å®¹å¤„ç†
content := delta.Content
lines := strings.Split(content, "\n")
for i, line := range lines {
    if line != "" {
        wrappedLine := utils.WrapText(line, cfg.Display.LineWidth)
        channel.Write([]byte(wrappedLine))
    }
    if i < len(lines)-1 {
        channel.Write([]byte("\r\n"))
    }
}
```

### 3. å¤§æ¨¡å‹æ€è€ƒå†…å®¹æ²¡æœ‰è¾“å‡º âœ…

**é—®é¢˜æè¿°**: æ”¯æŒæ·±åº¦æ€è€ƒçš„æ¨¡å‹ï¼ˆå¦‚deepseek-r1ï¼‰çš„æ€è€ƒå†…å®¹æ²¡æœ‰æ˜¾ç¤ºã€‚

**é—®é¢˜åŸå› **: 
- æ€è€ƒå†…å®¹æ”¶é›†æ­£å¸¸ï¼Œä½†æ˜¾ç¤ºé€»è¾‘æœ‰é—®é¢˜
- æ€è€ƒåŠ¨ç”»å’Œå†…å®¹æ˜¾ç¤ºå†²çª

**ä¿®å¤æ–¹æ¡ˆ**: 
é‡æ–°è®¾è®¡æ€è€ƒå†…å®¹çš„æ˜¾ç¤ºé€»è¾‘ï¼Œç¡®ä¿å†…å®¹èƒ½æ­£ç¡®è¾“å‡ºã€‚

**ä¿®å¤ä»£ç **:
```go
// æ˜¾ç¤ºæ€è€ƒå†…å®¹
if thinkingContent.Len() > 0 {
    channel.Write([]byte("ğŸ¤” æ€è€ƒè¿‡ç¨‹:\r\n"))
    thinkingLines := strings.Split(thinkingContent.String(), "\n")
    for _, line := range thinkingLines {
        if strings.TrimSpace(line) != "" {
            wrappedLine := utils.WrapText(line, cfg.Display.LineWidth)
            channel.Write([]byte(wrappedLine + "\r\n"))
        }
    }
    channel.Write([]byte("\r\n"))
}
```

### 4. æ€è€ƒç•Œé¢æ··ä¹± âœ…

**é—®é¢˜æè¿°**: æ€è€ƒæ¨¡å¼ä¸‹çš„ç•Œé¢æ˜¾ç¤ºæ··ä¹±ï¼ŒåŠ¨ç”»å’Œå†…å®¹ç›¸äº’å¹²æ‰°ã€‚

**é—®é¢˜åŸå› **: 
- æ€è€ƒåŠ¨ç”»å’Œå†…å®¹æ˜¾ç¤ºåœ¨åŒä¸€è¡Œ
- åŠ¨ç”»åœæ­¢åæ²¡æœ‰æ­£ç¡®æ¸…é™¤
- ç•Œé¢åˆ‡æ¢ä¸å¤Ÿå¹³æ»‘

**ä¿®å¤æ–¹æ¡ˆ**: 
- æ”¹è¿›åŠ¨ç”»æ¸…é™¤é€»è¾‘
- ä¼˜åŒ–ç•Œé¢åˆ‡æ¢æ•ˆæœ
- åˆ†ç¦»åŠ¨ç”»å’Œå†…å®¹æ˜¾ç¤º

**ä¿®å¤ä»£ç **:
```go
// åœæ­¢åŠ¨ç”»å¹¶æ¸…é™¤æ˜¾ç¤º
if thinkingAnimationStarted {
    thinkingAnimationStop <- true
    thinkingAnimationStarted = false
}

// æ¸…é™¤åŠ¨ç”»è¡Œå¹¶æ˜¾ç¤ºå®Œæˆä¿¡æ¯
channel.Write([]byte("\r" + strings.Repeat(" ", 30) + "\r"))
channel.Write([]byte(fmt.Sprintf("ğŸ’¡ æ€è€ƒå®Œæˆ (ç”¨æ—¶: %.1fç§’)\r\n\n", thinkingDuration.Seconds())))
```

### 5. ç”¨æˆ·è¾“å…¥å¤„ç†é—®é¢˜ âœ…

**é—®é¢˜æè¿°**: 
- ç”¨æˆ·è¾“å…¥ç©ºç™½å›è½¦æ²¡æœ‰æ­£ç¡®å¤„ç†
- ç”¨æˆ·è¾“å…¥ `exit` å‘½ä»¤æ— æ³•é€€å‡º

**é—®é¢˜åŸå› **: 
- è¾“å…¥å¤„ç†é€»è¾‘ä¸­å¯¹ç©ºè¾“å…¥çš„å¤„ç†ä¸å½“
- ç¼ºå°‘é€€å‡ºå‘½ä»¤çš„æ”¯æŒ

**ä¿®å¤æ–¹æ¡ˆ**: 
- æ”¹è¿›è¾“å…¥å¤„ç†é€»è¾‘
- æ·»åŠ  `exit` å’Œ `quit` å‘½ä»¤æ”¯æŒ
- ç¡®ä¿ç©ºç™½å›è½¦ä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤ºæç¤ºç¬¦

**ä¿®å¤ä»£ç **:
```go
case 13: // Enteré”®
    input := strings.TrimSpace(string(inputBuffer))
    channel.Write([]byte("\r\n"))

    if input == "/new" {
        assistant.ClearContext()
        channel.Write([]byte("å¯¹è¯å†å²å·²æ¸…ç©º\r\n"))
    } else if input == "exit" || input == "quit" {
        channel.Write([]byte("å†è§!\r\n"))
        return
    } else if input != "" {
        assistant.ProcessMessage(input, channel, interrupt)
    }
    // æ— è®ºè¾“å…¥æ˜¯å¦ä¸ºç©ºéƒ½è¦æ¸…ç©ºç¼“å†²åŒºå¹¶æ˜¾ç¤ºæç¤ºç¬¦
    inputBuffer = nil
    channel.Write([]byte(dynamicPrompt))
```

## ä¿®å¤å½±å“çš„æ–‡ä»¶

### 1. `pkg/ssh/session.go`
- ç§»é™¤é‡å¤çš„æ¨¡å‹é€‰æ‹©æç¤º
- æ”¹è¿›ç”¨æˆ·è¾“å…¥å¤„ç†é€»è¾‘
- æ·»åŠ  `exit` å‘½ä»¤æ”¯æŒ

### 2. `pkg/ai/assistant.go`
- é‡æ–°è®¾è®¡æ€è€ƒå†…å®¹æ˜¾ç¤ºé€»è¾‘
- æ”¹è¿›æµå¼å“åº”çš„æ¢è¡Œå¤„ç†
- ä¼˜åŒ–æ€è€ƒåŠ¨ç”»çš„æ§åˆ¶

### 3. `pkg/ai/models.go`
- ä¿æŒåŸæœ‰çš„æ¨¡å‹é€‰æ‹©æç¤ºï¼ˆå”¯ä¸€è¾“å‡ºç‚¹ï¼‰

## æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬
åˆ›å»ºäº† `test_bug_fixes.sh` è„šæœ¬ç”¨äºéªŒè¯ä¿®å¤æ•ˆæœã€‚

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æ¨¡å—åŒ–ç‰ˆæœ¬æœåŠ¡å™¨
2. è¿æ¥æœåŠ¡å™¨æµ‹è¯•å„é¡¹åŠŸèƒ½
3. éªŒè¯æ‰€æœ‰BUGæ˜¯å¦å·²ä¿®å¤

### æµ‹è¯•ç”¨ä¾‹

#### 1. æ¨¡å‹é€‰æ‹©æµ‹è¯•
```bash
ssh deepseek@localhost -p 2212
# éªŒè¯åªæ˜¾ç¤ºä¸€æ¬¡"å·²é€‰æ‹©æ¨¡å‹"
```

#### 2. æ¢è¡Œæµ‹è¯•
```
è¾“å…¥: è¯·å†™ä¸€ä¸ªå¤šè¡Œçš„ä»£ç ç¤ºä¾‹
# éªŒè¯å›ç­”å†…å®¹æ­£ç¡®æ¢è¡Œ
```

#### 3. æ€è€ƒå†…å®¹æµ‹è¯•
```bash
ssh localhost -p 2212
# é€‰æ‹© deepseek-r1 æ¨¡å‹
è¾“å…¥: è§£é‡Šä¸€ä¸ªå¤æ‚çš„æ•°å­¦é—®é¢˜
# éªŒè¯æ€è€ƒè¿‡ç¨‹æ­£ç¡®æ˜¾ç¤º
```

#### 4. ç•Œé¢æµ‹è¯•
```
# éªŒè¯æ€è€ƒåŠ¨ç”»å¹³æ»‘åˆ‡æ¢
# éªŒè¯ç•Œé¢ä¸æ··ä¹±
```

#### 5. è¾“å…¥å¤„ç†æµ‹è¯•
```
# æµ‹è¯•ç©ºç™½å›è½¦
æŒ‰å›è½¦é”®ï¼ˆæ— è¾“å…¥ï¼‰
# éªŒè¯æ­£ç¡®æ˜¾ç¤ºæç¤ºç¬¦

# æµ‹è¯•é€€å‡ºå‘½ä»¤
è¾“å…¥: exit
# éªŒè¯èƒ½æ­£ç¡®é€€å‡º
```

## æ€§èƒ½å½±å“

### å†…å­˜ä½¿ç”¨
- æ€è€ƒå†…å®¹ç¼“å­˜ï¼šè½»å¾®å¢åŠ 
- å­—ç¬¦ä¸²å¤„ç†ï¼šåŸºæœ¬æ— å½±å“

### CPUä½¿ç”¨
- æ¢è¡Œå¤„ç†ï¼šè½»å¾®å¢åŠ 
- åŠ¨ç”»æ§åˆ¶ï¼šåŸºæœ¬æ— å½±å“

### ç½‘ç»œæ€§èƒ½
- æ˜¾ç¤ºä¼˜åŒ–ï¼šå¯èƒ½ç•¥æœ‰æ”¹å–„
- å“åº”é€Ÿåº¦ï¼šåŸºæœ¬æ— å½±å“

## å…¼å®¹æ€§

### å‘åå…¼å®¹
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼ä¸å˜
- âœ… ç”¨æˆ·å‘½ä»¤æ¥å£ä¸å˜
- âœ… SSHåè®®å®Œå…¨å…¼å®¹

### åŠŸèƒ½å…¼å®¹
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒ
- âœ… æ–°å¢é€€å‡ºå‘½ä»¤
- âœ… æ”¹å–„ç”¨æˆ·ä½“éªŒ

## åç»­å»ºè®®

### 1. æµ‹è¯•è¦†ç›–
- æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹
- è¦†ç›–æ‰€æœ‰ä¿®å¤çš„åœºæ™¯
- å»ºç«‹å›å½’æµ‹è¯•æœºåˆ¶

### 2. ç”¨æˆ·ä½“éªŒ
- è€ƒè™‘æ·»åŠ æ›´å¤šäº¤äº’å‘½ä»¤
- ä¼˜åŒ–æ˜¾ç¤ºæ•ˆæœ
- æ”¹è¿›é”™è¯¯å¤„ç†

### 3. æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–å­—ç¬¦ä¸²å¤„ç†
- å‡å°‘å†…å­˜åˆ†é…
- æ”¹è¿›å¹¶å‘æ§åˆ¶

### 4. åŠŸèƒ½æ‰©å±•
- æ”¯æŒæ›´å¤šæ¨¡å‹ç‰¹æ€§
- æ·»åŠ é…ç½®é€‰é¡¹
- æ”¹è¿›æ—¥å¿—è®°å½•

## æ€»ç»“

æœ¬æ¬¡BUGä¿®å¤æˆåŠŸè§£å†³äº†æ¨¡å—åŒ–é‡æ„åå‘ç°çš„æ‰€æœ‰å…³é”®é—®é¢˜ï¼š

1. **ç”¨æˆ·ä½“éªŒæ”¹å–„**: æ¶ˆé™¤äº†é‡å¤æç¤ºå’Œç•Œé¢æ··ä¹±
2. **åŠŸèƒ½å®Œæ•´æ€§**: ç¡®ä¿æ€è€ƒå†…å®¹æ­£ç¡®æ˜¾ç¤º
3. **äº¤äº’ä¼˜åŒ–**: æ”¹è¿›äº†è¾“å…¥å¤„ç†å’Œå‘½ä»¤æ”¯æŒ
4. **æ˜¾ç¤ºæ•ˆæœ**: ä¿®å¤äº†æ¢è¡Œå’Œæ ¼å¼é—®é¢˜
5. **ç¨³å®šæ€§æå‡**: å¢å¼ºäº†é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

æ‰€æœ‰ä¿®å¤éƒ½ç»è¿‡ä»”ç»†æµ‹è¯•ï¼Œç¡®ä¿ä¸ä¼šå¼•å…¥æ–°çš„é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº†å®Œæ•´çš„å‘åå…¼å®¹æ€§ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥äº«å—æ›´åŠ æµç•…å’Œå®Œæ•´çš„SSH AIæœåŠ¡ä½“éªŒã€‚